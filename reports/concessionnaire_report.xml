<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template du rapport -->
    <template id="report_concessionnaire_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <h2>Fiche Concessionnaire</h2>
                        
                        <div class="row mt-4">
                            <div class="col-6">
                                <strong>Informations générales</strong>
                                <table class="table table-sm">
                                    <tr>
                                        <td>Code:</td>
                                        <td><span t-field="o.code"/></td>
                                    </tr>
                                    <tr>
                                        <td>Nom:</td>
                                        <td><span t-field="o.name"/></td>
                                    </tr>
                                    <tr>
                                        <td>Téléphone:</td>
                                        <td><span t-field="o.phone"/></td>
                                    </tr>
                                    <tr>
                                        <td>Email:</td>
                                        <td><span t-field="o.email"/></td>
                                    </tr>
                                    <tr>
                                        <td>Zone:</td>
                                        <td><span t-field="o.zone"/></td>
                                    </tr>
                                    <tr>
                                        <td>État:</td>
                                        <td><span t-field="o.state"/></td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div class="col-6">
                                <strong>Performance</strong>
                                <table class="table table-sm">
                                    <tr>
                                        <td>Score:</td>
                                        <td><span t-field="o.performance_score"/>%</td>
                                    </tr>
                                    <tr>
                                        <td>Classement:</td>
                                        <td>#<span t-field="o.ranking"/></td>
                                    </tr>
                                    <tr>
                                        <td>Trans/jour:</td>
                                        <td><span t-field="o.daily_transactions"/></td>
                                    </tr>
                                    <tr>
                                        <td>Volume mensuel:</td>
                                        <td><span t-field="o.monthly_volume" widget="monetary"/></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <strong>Kits distribués</strong>
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Numéro de série</th>
                                            <th>Type</th>
                                            <th>Modèle</th>
                                            <th>Date livraison</th>
                                            <th>État</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="o.kit_ids" t-as="kit">
                                            <tr>
                                                <td><span t-field="kit.serial_number"/></td>
                                                <td><span t-field="kit.kit_type"/></td>
                                                <td><span t-field="kit.phone_model"/></td>
                                                <td><span t-field="kit.delivery_date"/></td>
                                                <td><span t-field="kit.state"/></td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <strong>Dernières transactions</strong>
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Type</th>
                                            <th>Client</th>
                                            <th>Montant</th>
                                            <th>Commission</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-set="recent_trans" t-value="o.transaction_ids.sorted('transaction_date', reverse=True)[:10]"/>
                                        <t t-foreach="recent_trans" t-as="trans">
                                            <tr>
                                                <td><span t-field="trans.transaction_date" t-options='{"widget": "datetime"}'/></td>
                                                <td><span t-field="trans.transaction_type"/></td>
                                                <td><span t-field="trans.customer_name"/></td>
                                                <td><span t-field="trans.amount" widget="monetary"/></td>
                                                <td><span t-field="trans.commission" widget="monetary"/></td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>
    
    <!-- Action du rapport -->
    <report
        id="action_report_concessionnaire"
        string="Fiche Concessionnaire"
        model="hurimoney.concessionnaire"
        report_type="qweb-pdf"
        file="hurimoney_concessionnaires.report_concessionnaire"
        name="hurimoney_concessionnaires.report_concessionnaire_document"
        print_report_name="'Concessionnaire - %s' % (object.name)"
    />
</odoo>